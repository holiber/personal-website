---
import Button from './Button.astro';
export interface AboutContentType {
  name: string;
  jobTitle: string;
  title: string;
  subtitle: string;
  description: string;
  github: {
    username: string;
    avatar: string;
    url: string;
  };
  stats: { label: string; value: string; suffix: string }[];
  skills: { name: string; percentage: number }[];
  technologies: string[];
  cta: { text: string; href: string; icon: string; count: number };
}

export interface GithubCardProps {
  github: AboutContentType['github'];
  cta: AboutContentType['cta'];
  name: string;
  jobTitle: string;
}

interface Props extends GithubCardProps {}

const { github, cta, name, jobTitle } = Astro.props;

const months = [
  { name: 'Jan', index: 0, colspan: 4.2 },
  { name: 'Feb', index: 1, colspan: 4.2 },
  { name: 'Mar', index: 2, colspan: 4.2 },
  { name: 'Apr', index: 3, colspan: 4.2 },
  { name: 'May', index: 4, colspan: 4.2 },
  { name: 'Jun', index: 5, colspan: 4.2 },
  { name: 'Jul', index: 6, colspan: 4.2 },
  { name: 'Aug', index: 7, colspan: 4.2 },
  { name: 'Sep', index: 8, colspan: 4.2 },
  { name: 'Oct', index: 9, colspan: 4.2 },
  { name: 'Nov', index: 10, colspan: 4.2 },
  { name: 'Dec', index: 11, colspan: 4.2 },
];

const contributionPattern = [
  23, 24, 25, 26, 27, 29, 35, 36, 42, 44, 48, 58, 59, 60, 61, 62, 64, 70,
  71, 77, 79, 80, 81, 82, 83, 92, 93, 94, 95, 96, 97, 98, 99, 105, 106,
  112, 114, 115, 116, 117, 118, 127, 128, 129, 130, 131, 132, 133, 141,
  142, 143, 144, 145, 146, 147, 150, 158, 166, 169, 170, 171, 172, 173,
  174, 175, 184, 185, 186, 187, 188, 190, 193, 196, 197, 200, 203, 205,
  207, 208, 209, 228, 235, 240, 241, 242, 243, 244, 249, 256, 275, 276,
  277, 278, 279, 282, 287, 289, 294, 296, 301, 303, 308, 310, 315, 317,
  318, 319, 320, 321, 325, 328, 332, 335, 340, 341,
];
---

<div class="bg-gray-950 rounded-lg p-4 lg:p-6 shadow-2xl border border-gray-800 mb-8">
  <div class="flex justify-between items-center border-b border-gray-700 pb-4 mb-4">
    <div class="flex items-center gap-2">
      <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center overflow-hidden">
        <img src={github.avatar} alt="Programmer" class="size-8" />
      </div>
      <span class="text-gray-300 font-semibold inline-block">{github.username}</span>
    </div>
    <div class="flex items-center gap-3 text-sm">
      <div class="hidden lg:flex items-center gap-1 text-gray-400">
        <span class="w-3 h-3 rounded-sm bg-gray-600"></span>
        <span>Less</span>
      </div>
      <div class="hidden lg:flex items-center gap-1">
        <span class="w-3 h-3 rounded-sm bg-green-400"></span>
        <span class="w-3 h-3 rounded-sm bg-green-600"></span>
        <span class="w-3 h-3 rounded-sm bg-green-800"></span>
        <span class="w-3 h-3 rounded-sm bg-green-900"></span>
        <span class="w-3 h-3 rounded-sm bg-green-950"></span>
      </div>
      <div class="hidden lg:flex items-center gap-1 text-gray-400">
        <span>More</span>
      </div>
    </div>
  </div>
  <div class="overflow-x-auto pb-3">
    <div class="w-full flex flex-col">
      <div class="flex mb-1 pl-8">
        {months.map((month) => (
          <div
            class="text-xs text-gray-500 flex-shrink-0"
            style={`width: ${month.colspan * 16}px; margin-left: ${month.index === 0 ? 0 : 0}px;`}
          >
            <span>{month.name}</span>
          </div>
        ))}
      </div>
      <div class="flex items-center">
        <div class="flex flex-col gap-6 justify-between h-full text-xs text-gray-500 pr-2 w-8">
          <div>Mon</div>
          <div>Wed</div>
          <div>Fri</div>
        </div>
        <div class="grid grid-flow-col auto-cols-min gap-1">
          {Array.from({ length: 52 }).map((_, weekIndex) => (
            <div class="flex flex-col gap-1">
              {Array.from({ length: 7 }).map((_, dayIndex) => {
                const index = weekIndex * 7 + dayIndex + 1;
                const cellClass = contributionPattern.includes(index) ? 'bg-green-500' : 'bg-gray-700';
                return (
                  <div
                    class={`w-2 h-2 lg:w-3 lg:h-3 rounded-sm transition-colors duration-200 cursor-pointer ${cellClass}`}
                    x-on:mouseover="showTooltip({weekIndex}, {dayIndex}, $event)"
                    x-on:mouseout="hideTooltip()"
                  ></div>
                );
              })}
            </div>
          ))}
        </div>
      </div>
    </div>
  </div>
  <div
    x-ref="tooltip"
    class="absolute hidden bg-gray-800 text-white text-xs p-2 rounded shadow-lg border border-gray-700 z-20 pointer-events-none"
    x-text="tooltipText"
  ></div>
  <div class="text-center mt-10 mb-6">
    <h3 class="text-2xl lg:text-3xl font-bold font-code text-white mb-2" data-animate="fadeInUp" data-delay="100">
      {name}
    </h3>
    <p class="text-green-400 text-lg lg:text-xl" data-animate="fadeInUp" data-delay="200">
      {jobTitle}
    </p>
  </div>
  <div class="flex justify-center mb-4" data-animate="fadeInUp" data-delay="300">
    <Button href={cta.href} link={true} variant="outline" color="gray">
      <i class={cta.icon}></i>
      {cta.text}
      <span class="bg-gray-700 text-gray-300 text-xs rounded-full px-2 py-0.5 ml-1">{cta.count}</span>
    </Button>
  </div>
</div>